# 6.2 Implantação

## Introdução

Este documento fornece um guia completo e passo-a-passo para execução do software Digi Eventos, desde a configuração do ambiente de desenvolvimento até o deploy em produção. Todos os requisitos, configurações e procedimentos necessários são descritos em detalhes.

## Requisitos do Sistema

### Software Obrigatório

**Bun Runtime** (versão 1.0.0 ou superior):
- Runtime JavaScript/TypeScript de alta performance
- Substitui Node.js com execução até 3x mais rápida
- Gerenciador de pacotes integrado
- Instalação: https://bun.sh
- Necessário para executar tanto o backend quanto scripts de build

**Docker** (versão 20.10 ou superior):
- Plataforma de containerização
- Usado para executar PostgreSQL de forma isolada
- Garante ambiente consistente entre desenvolvedores
- Instalação: https://docs.docker.com/get-docker/

**Docker Compose** (versão 2.0 ou superior):
- Orquestração de múltiplos containers
- Gerencia PostgreSQL e MinIO simultaneamente
- Incluído nas versões recentes do Docker Desktop

**Git** (versão 2.30 ou superior):
- Controle de versão do código
- Necessário para clonar o repositório
- Instalação: https://git-scm.com/downloads

## Configuração do Ambiente de Desenvolvimento

### Passo 1: Clonar o Repositório

Abra um terminal e execute:

```bash
git clone https://github.com/ovitorhilario/ventos.git
cd ventos
```

Isso criará uma cópia local do código-fonte do projeto no diretório `ventos`.

### Passo 2: Instalar Dependências

O projeto usa Bun como gerenciador de pacotes. Execute no diretório raiz:

```bash
bun install
```

Este comando:
- Lê o arquivo `package.json` de cada aplicação
- Baixa todas as dependências necessárias
- Cria links simbólicos entre pacotes do monorepo
- Geralmente leva 1-3 minutos dependendo da conexão

### Passo 3: Configurar Variáveis de Ambiente

O sistema usa variáveis de ambiente para configurações sensíveis e específicas do ambiente.

#### Backend (apps/server/.env)

Crie o arquivo copiando o template:

```bash
cp apps/server/.env.example apps/server/.env
```

Abra `apps/server/.env` em um editor de texto e configure:

**DATABASE_URL**: String de conexão com PostgreSQL
- Formato: `postgresql://usuario:senha@host:porta/banco`
- Desenvolvimento: `postgresql://postgres:postgres@localhost:8081/digi_eventos`
- Em produção, use credenciais seguras e host do banco real

**JWT_SECRET**: Chave secreta para assinatura de tokens
- Deve ter no mínimo 32 caracteres
- Use uma string aleatória e segura
- NUNCA compartilhe ou versione esta chave
- Exemplo de geração: `openssl rand -base64 32`

**CORS_ORIGIN**: Origem permitida para requisições CORS
- Desenvolvimento: `http://localhost:3001`
- Produção: `https://seu-dominio.com`

**PORT**: Porta em que a API executará
- Padrão: `3000`
- Modifique se houver conflito com outro serviço

#### Frontend (apps/web/.env)

Crie o arquivo:

```bash
cp apps/web/.env.example apps/web/.env
```

Configure:

**VITE_API_URL**: URL base da API
- Desenvolvimento: `http://localhost:3000`
- Produção: `https://api.seu-dominio.com`

### Passo 4: Configurar Banco de Dados

#### Opção A: Docker (Recomendado)

A forma mais simples é usar Docker, que configura PostgreSQL automaticamente:

```bash
bun db:start
```

Este comando:
- Lê o arquivo `docker-compose.yml`
- Baixa as imagens PostgreSQL e MinIO (primeira vez leva alguns minutos)
- Cria e inicia containers na porta 8081 (PostgreSQL) e 9000 (MinIO)
- Configura usuário `postgres` com senha `postgres` para o banco
- Cria banco de dados `digi_eventos`
- Configura MinIO com credenciais padrão (minioadmin/minioadmin)

Aguarde cerca de 10 segundos para os serviços inicializarem completamente.

Para verificar se está rodando:

```bash
docker ps
```

Você deve ver os containers `digi-eventos-postgres` e `digi-eventos-minio` com status "Up".

#### Opção B: PostgreSQL Local

Se você já tem PostgreSQL instalado localmente:

1. Crie o banco de dados:
```bash
createdb digi_eventos
```

2. Atualize a `DATABASE_URL` no arquivo `.env` com suas credenciais locais.

### Passo 5: Aplicar Schema do Banco

Com o banco rodando, aplique a estrutura de tabelas:

```bash
bun db:push
```

Este comando:
- Lê o schema definido em `packages/db/src/schema/`
- Gera SQL para criar todas as tabelas
- Executa o SQL no banco de dados
- Cria índices e constraints necessários

Você verá mensagens confirmando a criação de cada tabela (users, events, registrations, categories).

### Passo 6: Popular com Dados Iniciais (Opcional)

Para facilitar testes, você pode inserir dados de exemplo:

```bash
bun db:seed
```

Isso cria:
- **Usuário Admin**: 
  - Email: `admin@digieventos.com`
  - Senha: `admin`
  - Pode gerenciar eventos e usuários

- **Usuários de Teste**:
  - `joao.silva@email.com` / senha: `password`
  - `maria.santos@email.com` / senha: `password`

- **Categorias**: Tecnologia, Esportes, Cultura, Educação

- **Eventos de Exemplo**: Vários eventos em diferentes categorias

### Passo 7: Iniciar Aplicação

Para iniciar todo o sistema de uma vez:

```bash
bun dev
```

Este comando:
- Inicia o backend (Elysia) na porta 3000
- Inicia o frontend (Vite) na porta 3001
- Habilita hot-reload (mudanças refletem automaticamente)
- Mostra logs de ambos serviços no terminal

#### Iniciar Serviços Separadamente

Se preferir controle individual:

**Terminal 1 - Backend**:
```bash
bun dev:server
```

**Terminal 2 - Frontend**:
```bash
bun dev:web
```

### Passo 8: Acessar a Aplicação

Abra seu navegador e acesse:

- **Frontend**: http://localhost:3001
- **API Backend**: http://localhost:3000
- **Documentação da API**: http://localhost:3000/openapi (se habilitado)

Faça login com as credenciais do usuário admin ou de teste para explorar o sistema.

## Ferramentas de Desenvolvimento

### Drizzle Studio

Interface visual para explorar e editar o banco de dados:

```bash
bun db:studio
```

Acesse: http://localhost:4983

Recursos:
- Visualizar todas as tabelas e dados
- Editar registros diretamente
- Executar queries SQL
- Ver relacionamentos entre tabelas

### Verificação de Tipos

Para verificar erros de TypeScript em todo projeto sem executar:

```bash
bun check-types
```

Útil antes de commits para garantir que tudo compila.

### Gerenciamento do Banco de Dados

**Parar containers Docker**:
```bash
bun db:stop
```
Mantém dados, apenas para os containers.

**Remover containers e volumes**:
```bash
bun db:down
```
Remove tudo, incluindo dados. Útil para recomeçar limpo.

**Reiniciar banco**:
```bash
bun db:down
bun db:start
bun db:push
```